<?xml version="1.0" encoding="UTF-8"?>
  <?xml-stylesheet type="text/xsl" href="rfc2629.xslt" ?>
  <!-- generated by https://github.com/cabo/kramdown-rfc2629 version 1.2.9 -->

<!DOCTYPE rfc SYSTEM "../Tools/rfcbootstrap/rfc2629.dtd" [
]>

<?rfc toc="yes"?>
<?rfc tocindent="yes"?>
<?rfc sortrefs="yes"?>
<?rfc symrefs="yes"?>
<?rfc strict="yes"?>
<?rfc compact="yes"?>
<?rfc comments="yes"?>
<?rfc inline="yes"?>

<rfc ipr="trust200902" docName="draft-nottingham-cache-header-00" category="std">

  <front>
    <title abbrev="Cache Header">The Cache HTTP Response Header</title>

    <author initials="M." surname="Nottingham" fullname="Mark Nottingham">
      <organization>Fastly</organization>
      <address>
        <email>mnot@mnot.net</email>
        <uri>https://www.mnot.net/</uri>
      </address>
    </author>

    <date year="2018"/>

    <area>General</area>
    
    <keyword>Internet-Draft</keyword>

    <abstract>


<t>To aid debugging, HTTP caches often append headers to a response detailing how they handled the request. This specification codifies that practice and updates it for HTTP’s current caching model.</t>



    </abstract>


    <note title="Note to Readers">


<t><spanx style="emph">RFC EDITOR: please remove this section before publication</spanx></t>

<t>The issues list for this draft can be found at <eref target="https://github.com/mnot/I-D/labels/cache-header">https://github.com/mnot/I-D/labels/cache-header</eref>.</t>

<t>The most recent (often, unpublished) draft is at <eref target="https://mnot.github.io/I-D/cache-header/">https://mnot.github.io/I-D/cache-header/</eref>.</t>

<t>Recent changes are listed at <eref target="https://github.com/mnot/I-D/commits/gh-pages/cache-header">https://github.com/mnot/I-D/commits/gh-pages/cache-header</eref>.</t>

<t>See also the draft’s current status in the IETF datatracker, at
<eref target="https://datatracker.ietf.org/doc/draft-nottingham-cache-header/">https://datatracker.ietf.org/doc/draft-nottingham-cache-header/</eref>.</t>


    </note>


  </front>

  <middle>


<section anchor="introduction" title="Introduction">

<t>To aid debugging, HTTP caches often append headers to a response detailing how they handled the request.</t>

<t>Unfortunately, the semantics of these headers are often unclear, and both the semantics and syntax used vary greatly between implementations.</t>

<t>This specification defines a single, new HTTP response header field, “Cache” for this purpose.</t>

<t>For example:</t>

<figure><artwork type="example"><![CDATA[
Cache: HIT_FRESH; node="reverse-proxy.example.com:80";
                  key="https://example.com/foo|Accept-Encoding:gzip"
       HIT_STALE; node="FooCDN parent"; fresh=-45; age=200; latency=3,
       MISS; node="FooCDN edge"; fresh=-45; age=200; latency=98,
]]></artwork></figure>

<section anchor="notational-conventions" title="Notational Conventions">

<t>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”,
“RECOMMENDED”, “NOT RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as
described in BCP 14 <xref target="RFC2119"/> <xref target="RFC8174"/> when, and only when, they appear in all capitals, as
shown here.</t>

<t>This document uses ABNF as defined in <xref target="RFC5234"/>, along with the “%s” extension for case sensitivity defined in <xref target="RFC7405"/>.</t>

</section>
</section>
<section anchor="the-cache-http-response-header" title="The Cache HTTP Response Header">

<t>The Cache HTTP response header indicates the handling of the request corresponding to the response it occurs within by caches along the path.</t>

<t>Its value is a Parameterised List <xref target="I-D.ietf-httpbis-header-structure"/>:</t>

<figure><artwork type="abnf"><![CDATA[
Cache   = sh-param-list
]]></artwork></figure>

<t>Each member of the parameterised list represents a cache that has handled the request.</t>

<t>The first member of the list represents the cache closest to the origin server, and the last member of the list represents the cache closest to the user agent (possibly including the user agent’s cache itself, if it chooses to append a value).</t>

<t>Caches determine when it is appropriate to add the Cache header field to a response. Some might decide to add it to all responses, whereas others might only do so when specifically configured to, or when the request contains a header that activates a debugging mode.</t>

<t>When adding a value to the Cache header field, caches SHOULD preserve the existing contents of the header, to allow debugging of the entire chain of caches handling the request.</t>

<t>Identifiers in the parameterised list members are expected to be cache-actions:</t>

<figure><artwork type="abnf"><![CDATA[
cache-action   = %s"HIT_FRESH"
               / %s"HIT_STALE"
               / %s"HIT_REFRESH_MODIFIED"
               / %s"HIT_REFRESH_NOT_MODIFIED"
               / %s"HIT_REFRESH_STALE"
               / %s"MISS"
               / %s"MISS_CLIENT"
               / %s"BYPASS"
               / %s"ERROR"
]]></artwork></figure>

<t>The semantics of cache-actions are:</t>

<t><list style="symbols">
  <t>HIT_FRESH - The cache used a fresh stored response to satisfy the request without going forward</t>
  <t>HIT_STALE - The cache used a stale stored response to satisfy the request without going forward</t>
  <t>HIT_REFRESH_MODIFIED - The cache had a stale stored response, went forward to validate it, and used the new response to satisfy the request</t>
  <t>HIT_REFRESH_NOT_MODIFIED - The cache had a stale stored response, went forward to validate it, and used the stored response to satisfy the request</t>
  <t>HIT_REFRESH_STALE - The cache had a stale stored response, went forward to validate it, and encountered a problem, so the stored response was used to satisfy the request</t>
  <t>MISS - The cache did not have a stored response, so the request was forwarded</t>
  <t>MISS_CLIENT - The client included request directives (e.g., Pragma, Cache-Control) that prevented the cache from returning a response, so the request was forwarded</t>
  <t>BYPASS - The cache was configured to forward the request without attempting to use a stored response</t>
  <t>ERROR - The cache was unable to use a stored response or obtain one by going forward</t>
</list></t>

<t>Caches SHOULD use the most specific cache-action to a given response, but are not required to use all cache-actions. Future updates to this specification can add additional cache-actions.</t>

<t>Each member of the Cache header can also have any (or all, or none) of the following parameters:</t>

<figure><artwork type="abnf"><![CDATA[
node           = sh-string
fresh          = sh-integer
age            = sh-integer
cacheable      = sh-boolean
key            = sh-string
latency        = sh-integer
cl_nm          = sh-boolean
]]></artwork></figure>

<t>Their semantics are:</t>

<t><list style="symbols">
  <t>“node” - a string identifying for the cache node. MAY be a hostname, IP address, or alias.</t>
  <t>“fresh” - an integer indicating the cache’s estimation of the freshness lifetime (<xref target="RFC7234"/>, Section 4.2.1) of this response in seconds, including any locally applied configuration. MAY be negative.</t>
  <t>“age” - an integer indicating the cache’s estimation of the age (<xref target="RFC7234"/>, Section 4.2.3) of this response in seconds. MUST be 0 or greater.</t>
  <t>“cacheable” - a boolean indicating whether the cache can store this response, according to <xref target="RFC7234"/>, Section 3 and any locally applied configuration.</t>
  <t>“key” - a string representing the key that the cache has associated with this response. This might include the request URL, request headers, and other values.</t>
  <t>“latency” - an integer indicating the amount of time in milliseconds between the receipt of a complete set of request headers and sending the complete set of response headers of this response, from the viewpoint of the cache. Note that this may not include buffering time in transport protocols and similar delays.</t>
  <t>“cl_nm” - a boolean indicating whether the response to the client had a 304 Not Modified status code.</t>
</list></t>

<t>While all of these parameters are OPTIONAL, caches are encouraged to use the ‘node’ parameter to identify themselves.</t>

</section>
<section anchor="security-considerations" title="Security Considerations">

<t>Information about a cache’s content can be used to infer the activity of those using it. Generally, access to sensitive information in a cache is limited to those who are authorised to access that information (using a variety of techniques), so this does not represent an attack vector in the general sense.</t>

<t>However, if the Cache header is exposed to parties who are not authorised to obtain the response it occurs within, it could expose information about that data.</t>

<t>For example, if an attacker were able to obtain the Cache header from a response containing sensitive information and access were limited to one person (or limited set of people), they could determine whether that information had been accessed before. This is similar to the information exposed by various timing attacks, but is arguably more reliable, since the cache is directly reporting its state.</t>

<t>Mitigations include use of encryption (e.g., TLS <xref target="RFC8446"/>)) to protect the response, and careful controls over access to response headers (as are present in the Web platform). When in doubt, the Cache header field can be omitted.</t>

</section>


  </middle>

  <back>

    <references title='Normative References'>





<reference  anchor="RFC2119" target='https://www.rfc-editor.org/info/rfc2119'>
<front>
<title>Key words for use in RFCs to Indicate Requirement Levels</title>
<author initials='S.' surname='Bradner' fullname='S. Bradner'><organization /></author>
<date year='1997' month='March' />
<abstract><t>In many standards track documents several words are used to signify the requirements in the specification.  These words are often capitalized. This document defines these words as they should be interpreted in IETF documents.  This document specifies an Internet Best Current Practices for the Internet Community, and requests discussion and suggestions for improvements.</t></abstract>
</front>
<seriesInfo name='BCP' value='14'/>
<seriesInfo name='RFC' value='2119'/>
<seriesInfo name='DOI' value='10.17487/RFC2119'/>
</reference>



<reference  anchor="RFC8174" target='https://www.rfc-editor.org/info/rfc8174'>
<front>
<title>Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</title>
<author initials='B.' surname='Leiba' fullname='B. Leiba'><organization /></author>
<date year='2017' month='May' />
<abstract><t>RFC 2119 specifies common key words that may be used in protocol  specifications.  This document aims to reduce the ambiguity by clarifying that only UPPERCASE usage of the key words have the  defined special meanings.</t></abstract>
</front>
<seriesInfo name='BCP' value='14'/>
<seriesInfo name='RFC' value='8174'/>
<seriesInfo name='DOI' value='10.17487/RFC8174'/>
</reference>



<reference  anchor="RFC5234" target='https://www.rfc-editor.org/info/rfc5234'>
<front>
<title>Augmented BNF for Syntax Specifications: ABNF</title>
<author initials='D.' surname='Crocker' fullname='D. Crocker' role='editor'><organization /></author>
<author initials='P.' surname='Overell' fullname='P. Overell'><organization /></author>
<date year='2008' month='January' />
<abstract><t>Internet technical specifications often need to define a formal syntax.  Over the years, a modified version of Backus-Naur Form (BNF), called Augmented BNF (ABNF), has been popular among many Internet specifications.  The current specification documents ABNF. It balances compactness and simplicity with reasonable representational power.  The differences between standard BNF and ABNF involve naming rules, repetition, alternatives, order-independence, and value ranges.  This specification also supplies additional rule definitions and encoding for a core lexical analyzer of the type common to several Internet specifications.  [STANDARDS-TRACK]</t></abstract>
</front>
<seriesInfo name='STD' value='68'/>
<seriesInfo name='RFC' value='5234'/>
<seriesInfo name='DOI' value='10.17487/RFC5234'/>
</reference>



<reference  anchor="RFC7405" target='https://www.rfc-editor.org/info/rfc7405'>
<front>
<title>Case-Sensitive String Support in ABNF</title>
<author initials='P.' surname='Kyzivat' fullname='P. Kyzivat'><organization /></author>
<date year='2014' month='December' />
<abstract><t>This document extends the base definition of ABNF (Augmented Backus-Naur Form) to include a way to specify US-ASCII string literals that are matched in a case-sensitive manner.</t></abstract>
</front>
<seriesInfo name='RFC' value='7405'/>
<seriesInfo name='DOI' value='10.17487/RFC7405'/>
</reference>



<reference anchor="I-D.ietf-httpbis-header-structure">
<front>
<title>Structured Headers for HTTP</title>

<author initials='M' surname='Nottingham' fullname='Mark Nottingham'>
    <organization />
</author>

<author initials='P' surname='Kamp' fullname='Poul-Henning Kamp'>
    <organization />
</author>

<date month='July' day='2' year='2018' />

<abstract><t>This document describes a set of data types and algorithms associated with them that are intended to make it easier and safer to define and handle HTTP header fields.  It is intended for use by new specifications of HTTP header fields as well as revisions of existing header field specifications when doing so does not cause interoperability issues.</t></abstract>

</front>

<seriesInfo name='Internet-Draft' value='draft-ietf-httpbis-header-structure-07' />
<format type='TXT'
        target='http://www.ietf.org/internet-drafts/draft-ietf-httpbis-header-structure-07.txt' />
</reference>



<reference  anchor="RFC7234" target='https://www.rfc-editor.org/info/rfc7234'>
<front>
<title>Hypertext Transfer Protocol (HTTP/1.1): Caching</title>
<author initials='R.' surname='Fielding' fullname='R. Fielding' role='editor'><organization /></author>
<author initials='M.' surname='Nottingham' fullname='M. Nottingham' role='editor'><organization /></author>
<author initials='J.' surname='Reschke' fullname='J. Reschke' role='editor'><organization /></author>
<date year='2014' month='June' />
<abstract><t>The Hypertext Transfer Protocol (HTTP) is a stateless \%application- level protocol for distributed, collaborative, hypertext information systems.  This document defines HTTP caches and the associated header fields that control cache behavior or indicate cacheable response messages.</t></abstract>
</front>
<seriesInfo name='RFC' value='7234'/>
<seriesInfo name='DOI' value='10.17487/RFC7234'/>
</reference>




    </references>

    <references title='Informative References'>





<reference  anchor="RFC8446" target='https://www.rfc-editor.org/info/rfc8446'>
<front>
<title>The Transport Layer Security (TLS) Protocol Version 1.3</title>
<author initials='E.' surname='Rescorla' fullname='E. Rescorla'><organization /></author>
<date year='2018' month='August' />
<abstract><t>This document specifies version 1.3 of the Transport Layer Security (TLS) protocol.  TLS allows client/server applications to communicate over the Internet in a way that is designed to prevent eavesdropping, tampering, and message forgery.</t><t>This document updates RFCs 5705 and 6066, and obsoletes RFCs 5077, 5246, and 6961.  This document also specifies new requirements for TLS 1.2 implementations.</t></abstract>
</front>
<seriesInfo name='RFC' value='8446'/>
<seriesInfo name='DOI' value='10.17487/RFC8446'/>
</reference>




    </references>



  </back>

<!-- ##markdown-source:
H4sIABPihVsAA71ZbXPbuBH+zl+B6qZzcUaSncTXyylNW59fGs34rbYzNzed
jgciIQoTkuABoBXd1fntfXYBSqRsJ9frSz44JAHs+z67C41Go8RrX6iJuFko
cShT/H13c3MprpSrTeXwpmSmbCJnM6vuJu2W8DEzaSVLHM6snPtRZbzXVb6Q
5SilbaMFbxvt7SWZ9Nj2cu/F6yTFY27saiKcz5JE13YivG2cf7m3993ey0Ra
JSfir6pSVhbJ0tgPuTVNPUk+qBXesomYVl7ZSvnREbFNEudlld3KwlTgsVIu
qfVE/N2bdCjwR1eZqvxQOGO9VXOHp1UZH7zVKZZSU9YyPpTYjCVdFbpS/0gS
2fiFsZNEjBKBf7pyE3E2FudrXflzMMOZtB+2V4zNZaV/ll6baiJOpPPFihdU
KXUxESWs9hf6M4ZGvNBYiL/wvnaT3d3lcjluV3eTpDK2BKk7BYHE1cnhyxcv
vpvAiNV8s5Ako9FIyBm0g1JJcmOE1JnI1KzJc0g2DB5mFzlh5l5VQta1qjIR
HOZgNiGFbUMgUx6i4qRYmKXwC7USC1i8UBm9YN9PjXJ+jBDSTrhapXquU1YY
Bs3wAjZ+Ib2oSSCdKoHToqkpKJzQXkB4lulrJ9LGWniApSOOpclUMY46wQ7q
9pz+eHN7FWRNkuewgzg+mt5cXE1EXSjpSKbS3ClwJYlUyrLMFPgoUTezIor3
HMaBAto5KCAK7YIofIpDGmLQOXxtIDE0+GPrl1z7RTMbI2B2yT2709HRbiFn
qnC73dj/0ziwKA1oW5WSas/Y5EPRVCyKW6hsJ7ID3y4TdnzkpA3z6BLfJepX
gWgKj+RQAtnDiqgvi0vBrr3bzRejWuLsA8GvFTxVOMNeZgE7DkLS+Qbeq3h1
enxzIuBPSTH3QdkhuCdr7p2FsVZ+PkZS7AI8dj+LG6weub3UGYItSb6izLcm
a9if/7/ATpL3lF++qRCwxWrIiw75WyGYiRF9ALmWCfkgcG+qFPFI1oAMM+MX
W0fps1tVXn4UjQPXO2lXIgcAAiQQd36pQESXCGqCJY5ZxxH1INEyNQdegaJw
0KdQQ1GpZbDHWt0gn0A+FtlQDBjKB5uIrxtbG6dA/wSf1EdJfAEnnz59at8S
PjMR76Y3tydXx9fv3iAnM/V2gNoAzdWotubjahx3U7hNXu8N3jCs9f8BzN8O
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
uyI8GLgVfm1/D5zBjsm/ADpZ/VDEHgAA

-->

</rfc>

